好的，这是湖科大教书匠2024年9月27日发布的2026考研计算机网络每日一题。

### 题目原文 (Markdown格式)

**【单选题】** 下列关于应用层利用网络层ICMP协议实现跟踪路由（traceroute）的叙述中，正确的是（ ）。

A. 传输路径中各路由器转发ICMP回送请求（Echo Request）报文时，会将自身IP地址填入报文。 

B. 传输路径中各路由器的发现是通过触发各路由器向源主机发送ICMP时间超过（Time Exceeded）差错报告报文实现的。 

C. 源主机通过给传输路径中的各路由器直接发送ICMP回送请求（Echo Request）报文来发现它们。 

D. 目的主机通过ICMP回送回答（Echo Reply）报文给源主机返回途径的路由器的地址列表。

------

### 408考研深度解析

**【考点分析】**

本题考察的是网络诊断工具**`traceroute`（或Windows下的`tracert`）的工作原理**。这是一个非常经典的应用层程序利用网络层协议（ICMP）功能的例子，是408考研的重点内容。

**`traceroute` 的核心工作机制：**

`traceroute`的目的是探测从源主机到目的主机路径上所经过的每一个路由器。它巧妙地利用了IP数据报首部中的**TTL（Time To Live，生存时间）字段**和**ICMP差错报告报文**。

1. **巧妙利用TTL**：TTL字段的本意是防止数据报在网络中无限循环。每经过一个路由器，TTL的值就会减1。当一个路由器收到一个IP数据报，并发现其TTL减1后变为0时，它会**丢弃该数据报**，并向源主机发送一个**ICMP“时间超过”（Time Exceeded）**的差错报告报文。
2. **逐跳探测过程**：
   - **探测第一跳**：源主机首先向目的主机发送一个IP数据报（可以是UDP或ICMP Echo Request报文），并将该报文的**TTL设置为1**。当这个报文到达路径上的第一个路由器时，该路由器将TTL减1得0，于是丢弃报文，并向源主机发回一个ICMP“时间超过”报文。这个ICMP报文的**源IP地址**就是第一跳路由器的IP地址。
   - **探测第二跳**：源主机接着发送一个**TTL为2**的报文。这个报文能成功通过第一跳路由器（TTL变为1），但在到达第二跳路由器时，TTL被减为0。于是第二跳路由器丢弃报文，并向源主机发回ICMP“时间超过”报文，从而暴露了自己的IP地址。
   - **以此类推**：源主机不断增加发送报文的TTL值（3, 4, 5, ...），就可以依次获得路径上每一个路由器的IP地址。
3. **到达终点**：当设置的TTL值足够大，使得数据报最终能够到达目的主机时，`traceroute`就停止了。
   - 如果`traceroute`发送的是UDP报文（通常发往一个不可能的端口），目的主机会返回一个**ICMP“目的不可达”（端口不可达）**的差错报文。
   - 如果`traceroute`发送的是ICMP回送请求报文，目的主机会返回一个**ICMP回送回答（Echo Reply）**报文。
   - 无论哪种情况，源主机收到这些来自目的主机的响应后，就知道探测过程已经完成。

**选项分析：**

- **A. ...路由器转发...时，会将自身IP地址填入报文。**
  - **错误**。路由器在转发数据报时，通常只修改TTL和重算首部检验和，不会修改数据报内容或将自己地址填入。路由器的地址是通过它自己**生成并发送**的ICMP差错报文的源地址来得知的。
- **B. ...路由器的发现是通过触发各路由器向源主机发送ICMP时间超过...报文实现的。**
  - **正确**。这精确地描述了`traceroute`的核心原理。通过巧妙设置TTL值，有意地让路径上的路由器逐个丢弃报文并返回ICMP“时间超过”报文。
- **C. 源主机通过给...各路由器直接发送ICMP回送请求...来发现它们。**
  - **错误**。`traceroute`的出发点是**不知道**中间有哪些路由器。它所有的探测报文的**最终目的地址**都设置为**目的主机**的IP地址，而不是中间路由器的地址。
- **D. 目的主机通过ICMP回送回答...返回途径的路由器的地址列表。**
  - **错误**。目的主机只在探测结束时做出响应，它并不知道也不负责收集整个路径上的路由器信息。路径信息是在源主机端，通过收集一路上的ICMP“时间超过”报文来**逐步构建**的。这与IP首部中的“记录路由”选项功能类似，但`traceroute`不使用该选项。

**【备考提示】** `ping`和`traceroute`是必须掌握的两个基于ICMP的工具。

- **`ping`**：用于测试连通性和测量往返时间（RTT），原理是**ICMP回送请求（Echo Request）\**和\**ICMP回送回答（Echo Reply）**。
- **`traceroute`**：用于跟踪路由路径，原理是**IP首部的TTL字段**和**ICMP时间超过（Time Exceeded）**报文。 考生需要能够清晰地阐述两者的工作原理，并区分它们所依赖的ICMP报文类型。